# Perf: json_bytes-only throttle, 100 keys, metrics OFF
sources:
  in:
    type: demo_logs
    format: json
    count: 100000
    interval: 0

transforms:
  add_key:
    type: remap
    inputs: ["in"]
    source: '.service = "svc-" + to_string(to_int(now()) % 100)'

  throttle:
    type: throttle
    inputs: ["add_key"]
    window_secs: 60
    key_field: "{{ service }}"
    threshold:
      json_bytes: 1000000

sinks:
  out:
    type: blackhole
    inputs: ["throttle"]
