# Vector configuration demonstrating automatic native → OTLP conversion
#
# This config uses the new auto-conversion feature where native Vector logs
# are automatically converted to OTLP format WITHOUT requiring a VRL transform.
#
# Previously, users had to manually construct the OTLP structure using VRL.
# Now, the opentelemetry sink with `codec: otlp` does this automatically.

sources:
  source0:
    type: opentelemetry
    grpc:
      address: 0.0.0.0:4317
    http:
      address: 0.0.0.0:4318
      keepalive:
        max_connection_age_jitter_factor: 0.1
        max_connection_age_secs: 300
    # use_otlp_decoding: false (default) - logs are in flat native format
    # The OTLP encoder will automatically convert them

  internal_metrics:
    type: internal_metrics
    scrape_interval_secs: 60

sinks:
  # OpenTelemetry sink with automatic native → OTLP conversion
  otel_sink:
    inputs: [ "source0.logs" ]
    type: opentelemetry
    protocol:
      type: http
      uri: http://otel-collector-sink:5318/v1/logs
      method: post
      encoding:
        # The OTLP codec now automatically converts native logs to OTLP format
        codec: otlp
      batch:
        max_events: 1

  # File sink for verification
  otel_file_sink:
    type: file
    path: "/output/opentelemetry-native/vector-file-sink.log"
    inputs:
      - source0.logs
    encoding:
      codec: json

  metrics_file_sink:
    type: file
    path: "/output/opentelemetry-native/vector-internal-metrics-sink.log"
    inputs:
      - internal_metrics
    encoding:
      codec: json
